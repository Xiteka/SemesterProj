<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drink It</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div id="container"></div>

  <script type="module">

    //------------------------ ～> Declarations <～ --------------------------------//

    await insertTemplatesFrom("templates.html");
    const container = document.getElementById("container");

    // ┉> Template Pages <┉
    const starterPage = document.querySelector("#starterPage");
    const logInPage = document.querySelector("#logInPage");
    const CreateUserPage = document.querySelector("#CreateUserPage")
    const homePageses = document.querySelector("#homePageses")


    // ┉> Buttun Pages <┉
    const toLogInPageBtn = document.getElementById("toLogInPageBtn");
    const toCreateUserPageBtn = document.getElementById("toCreateUserPageBtn");


    //------------------------App functionality (JAVASCRIPT) ----------------------------------//
    const id = localStorage.getItem("userId")
    if (!id) {
      const starterPageContent = starterPage.content.cloneNode(true);
      container.appendChild(starterPageContent);
    } else {
      const homePagesesContent = homePageses.content.cloneNode(true);
      container.appendChild(homePagesesContent);

    }
    //------------------------Functions----------------------------------//

    async function insertTemplatesFrom(source) {
      const templates = await fetch(source).then(d => d.text());
      document.body.insertAdjacentHTML("beforeend", templates);
    }

    async function createUser(url, data) {
      const header = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      };

      const respon = await fetch(url, header);
      return respon;
    }

    async function logIn(url, data) {
      const header = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      };

      const respon = await fetch(url, header);
      return respon;
    }

    async function deleteUser(url) {
      const header = {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
        },
      };

      try {
        const respon = await fetch(url, header);
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response;

      } catch (error) {
        console.error("Error during delete request:", error);
        throw error;
      }
    }
    
    async function createDrinkData(url, data) {
      const header = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      };

      const respon = await fetch(url, header);
      return respon;
    }

    //--------------------------Event and buttons --------------------------------//
    container.addEventListener("click", async function (evt) {
      if (evt.target.id === "toLogInPageBtn") {

        container.innerHTML = "";
        const logInPageContent = logInPage.content.cloneNode(true);
        container.appendChild(logInPageContent);

        const logInBtn = document.getElementById("logInBtn");
        logInBtn.addEventListener("click", async function (evt) {

          const errorLogIn = document.getElementById("errorLogIn")
          const email = document.getElementById("logInInp").value;
          console.log(email);
          const password = document.getElementById("passwordInp").value;
          const user = { email, password }
          console.log(user);
          const response = await logIn("/user/loggIn", user)
          console.log(response);
          if (response.status != 200) {
            errorLogIn.innerHTML = "Wrong username or password"
          }
          const responseData = await response.json();
          const userId = responseData.id
          localStorage.setItem("userId", userId)

          // HOMEPAGE
          container.innerHTML = "";
          const homePagesesContent = homePageses.content.cloneNode(true);
          container.appendChild(homePagesesContent);

          let count = 0;
          const increcebtn = document.getElementById("increcebtn");
          const decresebtn = document.getElementById("decresebtn");
          increcebtn.onclick = function () {
            const userId = localStorage.getItem("userId");
            const description = counterLabel.value;
            //date ? ask OmarChan const date = value 
            count += 1;
            const counterLabel = document.getElementById("counterLabel")
            counterLabel.innerHTML = count;
          }
          decresebtn.onclick = function () {
            count -= 1;
            counterLabel.innerHTML = count;
          }
        })

      } else if (evt.target.id === "toCreateUserPageBtn") {
        container.innerHTML = "";
        const CreateUserPageContent = CreateUserPage.content.cloneNode(true);
        container.appendChild(CreateUserPageContent);

        const signUpBtn = document.getElementById("signUpBtn");

        signUpBtn.addEventListener("click", async function (evt) {

          const name = document.getElementById("nameCreateUserInp").value;
          const email = document.getElementById("loggCreateUserInInp").value;
          const password = document.getElementById("passwordCreateUserInp").value;
          const user = { name, email, password }
          console.log(user);
          const response = await createUser("/user/", user)
          console.log(response);
          if (response.status != 200) {
            errorLogIn.innerHTML = "Wrong username or password"
          }
          const responseData = await response.json();
          const userId = responseData.id
        })


      }
    })


  </script>

</body>

</html>